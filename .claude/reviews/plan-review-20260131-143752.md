# Plan Review: swift-wobbling-haven.md

**Reviewed by**: Code Council (5 models + consensus)
**Date**: 2026-01-31 14:37:52
**Confidence**: High (strong agreement across all models)

## Must Fix

- **Symlink Handling**: The plan doesn't specify symlink behavior. Bun's `fs.glob` follows symlinks by default, which can cause infinite loops or unwanted traversal. Add `followSymlinks: false` (or `follow: false`) option explicitly.

- **Error Handling Missing**: The `discoverFiles` function has no try/catch. Permission errors, missing directories, or broken symlinks will cause unhandled failures. Add error handling with meaningful error types.

- **Watcher Pattern Compatibility**: Chokidar uses `anymatch` library for pattern matching, not Bun's glob. Validate that the centralized patterns work identically with chokidar's `ignored` option before refactoring. Test by creating/modifying files in excluded directories.

## Consider

- **Bun Version Requirement**: `fs.glob` with `exclude` support requires Bun >= 1.1.26. Pin this version in package.json engines field.

- **Input Normalization**: If a user provides `src` (directory path) instead of `src/**/*` (glob), `fs.glob(['src'])` returns nothing useful. Consider normalizing inputs that don't contain wildcards.

- **Memory for Large Repos**: The plan collects all files into memory before processing. For 100k+ file repos, consider a streaming/generator approach (`async function* discoverFilesStream`).

- **Performance Benchmark**: Add before/after timing comparison to verify no regression. Test on a real project with 10k+ files.

## Filtered Suggestions

12 scope-expansion or nice-to-have suggestions were filtered out, including:
- `.docleaignore` file support
- OpenTelemetry metrics
- Feature flags for legacy fallback
- Configuration file support
- Backward compatibility deprecation warnings

These do not affect the plan's viability.

## Verdict

**Ready to Implement** (with 3 must-fix items)

The plan is technically sound with high consensus across all 5 models (scores: 8/10, 8.5/10, approved). The core approach of using Bun's native glob API is correct and eliminates regex complexity. Address the symlink handling, error handling, and chokidar compatibility before implementation.

**Estimated effort**: 6-8 hours (1 day) including the must-fix items.